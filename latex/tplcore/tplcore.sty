% Theorems, definitions, problems and other counters
\newcounter{theorems}
\newcommand*{\lemma}{\refstepcounter{theorems}\textbf{Лемма \arabic{theorems}. }}
\newcommand*{\theorem}{\refstepcounter{theorems}\textbf{Теорема \arabic{theorems}. }}
\newcommand*{\lemman}[1]{\refstepcounter{theorems}\textbf{Лемма \arabic{theorems} (#1). }}
\newcommand*{\theoremn}[1]{\refstepcounter{theorems}\textbf{Теорема \arabic{theorems} (#1). }}

\newcounter{defs}
\newcommand*{\definition}[1]{\refstepcounter{defs}\textbf{Определение \arabic{defs}. #1 ---}}

\newcounter{probs}
\newcounter{sprobs}[probs]
\newcommand*{\z}{\refstepcounter{probs}\textbf{№\arabic{probs}. }}
\newcommand*{\zn}[1]{\refstepcounter{probs}\textbf{№\arabic{probs} (#1).}}
\newcommand*{\n}{\refstepcounter{probs}\refstepcounter{sprobs}\textbf{№\arabic{probs}.\asbuk{sprobs}) }}
\newcommand*{\nn}[1]{\refstepcounter{probs}\refstepcounter{sprobs}\textbf{№\arabic{probs}.\asbuk{sprobs}) (#1) }}
\newcommand*{\p}{\refstepcounter{sprobs}\textbf{\asbuk{sprobs}) }}
\newcommand*{\pn}[1]{\refstepcounter{sprobs}\textbf{\asbuk{sprobs}) (#1) }}
\newcommand*{\s}{\textbf{Решение. }}
\renewcommand{\thetheorems}{\textbf{Т. \arabic{theorems}}}
\renewcommand{\theprobs}{\textbf{№\arabic{probs}}}
\renewcommand{\thesprobs}{\textbf{№\arabic{probs}.\asbuk{sprobs}}}

\newcommand*{\QEDA}{\hfill\ensuremath{\blacksquare}}

\newcommand{\floor}[1]{{\left\lfloor#1\right\rfloor}}
\newcommand{\ceil}[1]{{\left\lceil#1\right\rceil}}
\newcommand{\lrp}[1]{\left(#1\right)}
\newcommand{\lrb}[1]{\left[#1\right]}

\newcommand{\bs}{\textbackslash}
\newcommand{\com}[1]{\texttt{\bs #1}}

\newcommand{\proof}{\textbf{Доказательство. }}
\newcommand{\prooft}[1]{\textbf{Доказательство теоремы~\ref{#1}. }}
\newcommand{\prooftms}[1]{\newcounter{tproof#1}}
\newcommand{\prooftm}[1]{\refstepcounter{tproof#1}\textbf{Доказательство теоремы~\ref{#1}~\#\arabic{tproof#1}. }}
\newcommand{\prooftmn}[2]{\refstepcounter{tproof#1}\textbf{Доказательство теоремы~\ref{#1}~\#\arabic{tproof#1} (#2). }}
\newcommand{\proofl}[1]{\textbf{Доказательство леммы~\ref{#1}. }}
\newcommand{\prooflms}[1]{\newcounter{lproof#1}}
\newcommand{\prooflm}[1]{\refstepcounter{lproof#1}{\bf Доказательство леммы~\ref{#1}~\#\arabic{lproof#1}. }}
\newcommand{\prooftf}[2]{\textbf{Доказательство теоремы~\ref{#1} #2.}}
\newcommand{\prooff}[1]{\textbf{Доказательство формулы~\ref{#1}.}}

\newcommand{\dup}[2][2]{
	\foreach \t in {1,...,#1}{#2}
}

\newcommand{\odbegin}[3][\today]{
\begin{document}
\begin{center}
{\it #2, #1}
\vskip9pt
\centerline{\Large\scshape #3}
\vskip9pt\hrule\vskip14pt
\end{center}
}

\newcommand{\dsection}[2]{
\newpage
\begin{center}
	{\large\scshape #1}\\
	{\scshape #2}
	\vskip9pt\hrule\vskip14pt
\end{center}
}

\newcommand{\dbegin}[4][\today]{
\dbeginn{#1 --- \today}{#2}{#3}{#4}
}

\newcommand{\dbeginn}[4]{
\begin{center}
\textit{#2}
\vskip9pt\hrule\vskip14pt
\vfill
{\Large\bf #3}
\vskip20pt
{\large\bf #4}
\vfill
\textit{#1}
\end{center}
\newpage
}

\newcommand{\hdr}[1]{\centerline{\large\scshape #1}}
\newcommand{\shdr}[1]{\centerline{\scshape #1}}

% Inkscape Figures
\newcommand{\inkscapeinclude}[3][1]{
	\def\svgwidth{\columnwidth/#1}
	\import{./Figures/}{#2.pdf_tex}
}

\newcommand{\imageinclude}[3][1]{
	\includegraphics[width=#1\textwidth]{Figures/#2}
}

\newcommand{\inkscapefigure}[3][2]{
\begin{figure}[ht]
	\centering
	\inkscapeinclude[#1]{#2}{#3}
	\caption{#3}
	\label{figure:#2}
\end{figure}
}

\newcommand{\imagefigure}[3][0.5]{
\begin{figure}[ht]
	\centering
	\imageinclude[#1]{#2}{#3}
	\caption{#3}
	\label{figure:#2}
\end{figure}
}

% Math Things
\renewcommand{\Im}{\operatorname{Im}}
\renewcommand{\Re}{\operatorname{Re}}
\newcommand{\Id}{\operatorname{Id}}

% WARNING: THE PARTIAL-PURE TEX SECTION BELOW
% TikZ Geometry
\newcommand{\qscale}{1}
\newcommand{\qsetscale}[1]{\renewcommand{\qscale}{#1}}
\newcommand{\qrectangle}[5][black]{\tikzmath{
	\x = #2 * \qscale;
	\y = #3 * \qscale;
	\w = #4 * \qscale;
	\h = #5 * \qscale;
	{
		\fill[#1] (\x,\y) rectangle ++(\w,\h);
	};
}}
\newcommand{\qgrid}[3][very thin,black!30]{\tikzmath{
	\w = #2 * \qscale;
	\h = #3 * \qscale;
	{
		\draw[step=\qscale,#1] (0,0) grid ++(\w,\h);
	};
}}
\newcommand{\qtriangle}[7][black]{\tikzmath{
	\xa = #2 * \qscale;
	\xb = #4 * \qscale;
	\xc = #6 * \qscale;
	\ya = #3 * \qscale;
	\yb = #5 * \qscale;
	\yc = #7 * \qscale;
	{
		\draw[#1] (\xa,\ya) -- (\xb,\yb) -- (\xc,\yc) -- cycle;
	};
}}
\newcommand{\qcoord}[3]{%
	\expandafter\edef\csname q@x#1\endcsname{#2}%
	\expandafter\edef\csname q@y#1\endcsname{#3}%
	\expandafter\edef\csname q@c#1\endcsname{\{#2\}\{#3\}}%
}
\newcommand{\qrcoord}[3]{%
	\global\expandafter\edef\csname q@x#1\endcsname{#2}%
	\global\expandafter\edef\csname q@y#1\endcsname{#3}%
	\global\expandafter\edef\csname q@c#1\endcsname{\{#2\}\{#3\}}%
}
\newcommand{\qcx}[1]{\csname q@x#1\endcsname}
\newcommand{\qcy}[1]{\csname q@y#1\endcsname}
\newcommand{\qctriangle}[4][black]{
	\qtriangle[#1]{\qcx{#2}}{\qcy{#2}}{\qcx{#3}}{\qcy{#3}}{\qcx{#4}}{\qcy{#4}}
}

\newcommand{\qpoint}[4][above]{\tikzmath{
	\x = #3 * \qscale;
	\y = #4 * \qscale;
	{
		\fill[#1] (\x,\y) circle[radius=0.1];
		\draw (\x,\y) node[#1]{#2};
	};
}}
\newcommand{\qcpoint}[3][above]{\qpoint[#1]{#3}{\qcx{#2}}{\qcy{#2}}}
\newcommand{\qcspoint}[2][above]{\qcpoint[#1]{#2}{$#2$}}

\newcommand{\qsegment}[5][]{\tikzmath{
	\xa = #2 * \qscale;
	\xb = #4 * \qscale;
	\ya = #3 * \qscale;
	\yb = #5 * \qscale;
	{
		\draw[#1] (\xa,\ya) -- (\xb,\yb);
	};
}}
\newcommand{\qcsegment}[3][]{\qsegment[#1]{\qcx{#2}}{\qcy{#2}}{\qcx{#3}}{\qcy{#3}}}

\newcommand{\qcgMidpoint}[3]{\tikzmath{
	\x = (\qcx{#2} + \qcx{#3}) / 2;
	\y = (\qcy{#2} + \qcy{#3}) / 2;
	{
		\qrcoord{#1}{\x}{\y}
	};
}}

% Building [AB intersection CD]
\newcommand{\qcgIntersection}[5]{\tikzmath{
	\xa = \qcx{#2};
	\ya = \qcy{#2};
	\xb = \qcx{#3};
	\yb = \qcy{#3};
	\xc = \qcx{#4};
	\yc = \qcy{#4};
	\xd = \qcx{#5};
	\yd = \qcy{#5};
	\a = \yb - \ya; \b = \xa - \xb; \c = \xa * (\yb - \ya) + \ya * (\xa - \xb);
	\p = \yd - \yc; \q = \xc - \xd; \r = \xc * (\yd - \yc) + \yc * (\xc - \xd);
	\y = (\c*\p - \a*\r) / (\b*\p - \a*\q);
	\x = (\c*\q - \r*\b) / (\a*\q - \b*\p);
	{
		\qrcoord{#1}{\x}{\y}
	};
}}

% Drop perpendicular from A to BC
\newcommand{\qcgHeight}[4]{\tikzmath{
	\xa = \qcx{#2};
	\ya = \qcy{#2};
	\xb = \qcx{#3};
	\yb = \qcy{#3};
	\xc = \qcx{#4};
	\yc = \qcy{#4};
	\xd = \xa + \yc - \yb;
	\yd = \ya + \xb - \xc;
	{
		\qrcoord{#1}{\xd}{\yd}
		\qcgIntersection{#1}{#3}{#4}{#2}{#1}
	};
}}

% Draw circle with A center passing through B
\newcommand{\qccircle}[2]{\tikzmath{
	\xa = \qcx{#1} * \qscale;
	\ya = \qcy{#1} * \qscale;
	\xb = \qcx{#2} * \qscale;
	\yb = \qcy{#2} * \qscale;
	{
		\node[draw] at (\xa,\ya) [circle through={(\xb,\yb)}] {};
	};
}}

% Calculate circumcenter of ABC
\newcommand{\qcgCenter}[4]{\tikzmath{
	\xa = \qcx{#2};
	\ya = \qcy{#2};
	\xb = \qcx{#3};
	\yb = \qcy{#3};
	\xc = \qcx{#4};
	\yc = \qcy{#4};
	\xas = \xb + \xc - \xa;
	\yas = \yb + \yc - \ya;
	\xbs = \xc + \xa - \xb;
	\ybs = \yc + \ya - \yb;
	\xcs = \xa + \xb - \xc;
	\ycs = \ya + \yb - \yc;
	\xma = (\xb + \xc) / 2;
	\yma = (\yb + \yc) / 2;
	\xmb = (\xa + \xc) / 2;
	\ymb = (\ya + \yc) / 2;
	{
		\qrcoord{temp}{\xma}{\yma}
		\qrcoord{tempp}{\xcs}{\ycs}
		\qcgHeight{tempq}{temp}{tempp}{#2}
		\qrcoord{temppp}{\xmb}{\ymb}
		\qcgHeight{tempp}{temppp}{tempp}{#3}
		\qcgIntersection{#1}{temp}{tempq}{temppp}{tempp}
	};
}}

% Draw circumcircle of triangle ABC
\newcommand{\qcccircle}[3]{
	\qcgCenter{temp}{#1}{#2}{#3}
	\qccircle{temp}{#2}
}

% Drop angle bisector from A to BC
\newcommand{\qcgBisector}[4]{\tikzmath{
	\xa = \qcx{#2};
	\ya = \qcy{#2};
	\xb = \qcx{#3};
	\yb = \qcy{#3};
	\xc = \qcx{#4};
	\yc = \qcy{#4};
	\mac = sqrt((\xa-\xc)^2+(\ya-\yc)^2);
	\mab = sqrt((\xa-\xb)^2+(\ya-\yb)^2);
	\xl = (\xc * \mab + \xb * \mac) / (\mac + \mab);
	\yl = (\yc * \mab + \yb * \mac) / (\mac + \mab);
	{
		\qrcoord{#1}{\xl}{\yl}
	};
}}

% Draw incircle of ABC
\newcommand{\qcicircle}[3]{
	\qcgBisector{temp}{#1}{#2}{#3}
	\qcgBisector{tempp}{#2}{#1}{#3}
	\qcgIntersection{temp}{#1}{temp}{#2}{tempp}
	\qcgHeight{tempp}{temp}{#1}{#2}
	\qccircle{temp}{tempp}
}

\endinput
